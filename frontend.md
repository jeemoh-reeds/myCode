<<<<<<< HEAD
# Project EpiphannieA Documentation by Ridwan (Frontend)

Created folder called epiphanniea

Created subfolder called html

Created subfolder called admin

Created the following pages using html, css and bootstrap
1. awin.html
2. amazon.html
3. merchants.html
4. networks.html
5. product-set.html

The pages "style.css" and "main.js" were created outside the html folder 

The website was uploaded to the internet and was connected to my local computer using SFTP extension on VS code, this allows for changes I make to be uploaded to the epiphannie server

## Setting Up SFTP
Step 1: Under .vscode, go to sftp.json and set a directory to the privateKeyPath

Step 2: Put the ssh file gotten from Mr Tolu into the directory specified above

Step 3: Clone the epiphanniea folder off github using the source control extension into a directory of your choice and edit the files under "html" 

The url for the awin page is [AWIN](https://rievive.epiphanniea.co.uk/admin/awin.html)

For other pages, simply replace the awin in the url with the name of the page you wish to visit

The url for the database of the AWIN page is [AWIN DB](https://rievive.epiphanniea.co.uk/api/admin/network/AWIN)

Replace AWIN with the name of the page whose db you want to access

## Fetching the API from the backend and connecting it to the front end
The API endpoints generated by the backend developer is modified to be able to accept input from the frontend and save it to the database using fetch and also be able to load the last saved configuration when the page reloads

The API endpoint for AWIN and AMAZON are the same

1. The code received from the backend to save the configuration inputed is;

 ```Javascript 
 var myHeaders = new Headers();
myHeaders.append("Content-Type", "application/json");

var raw = JSON.stringify({
  "name": "AWIN",
  "config": {
    "publisherId": "25363",
    "trackId": "64346"
  }
});

var requestOptions = {
  method: 'POST',
  headers: myHeaders,
  body: raw,
  redirect: 'follow'
};

fetch("http://178.62.36.122/api/admin/network", requestOptions)
  .then(response => response.text())
  .then(result => console.log(result))
  .catch(error => console.log('error', error));
 ```

 This was later modified into

 ```Javascript 
 async function saveNetworkConfig(name, config) {
  var myHeaders = new Headers();
  myHeaders.append("Content-Type", "application/json");

  var raw = JSON.stringify({
    name: name,
    config: config,
  });

  var requestOptions = {
    method: "POST",
    headers: myHeaders,
    body: raw,
    redirect: "follow",
  };

  try {
    const response = await fetch("/api/admin/network/", requestOptions);
    const result = await response.json();
    return result;
  } catch (error) {
    console.log("error", error);
    throw error;
  }
}
 ```
The above code is saved on the main.js, this code is parameterized hence to add new networks to the endpoints, the parameters are only required to be referenced correctly

>Note
* An async function was created to save the parameters inputed in the page to the database
* Under JSON.stringify, the config was assigned to a const variable created on the individual pages called "config", the data for the variables are unique for AMAZON and AWIN and are declared inside the script tags of those pages
* The initial method for fetching was modified from .then to try and catch ***

2. The code to load the last saved configuration is
```Javascript
async function getNetworkConfig(name) {
  var requestOptions = {
    method: "GET",
    redirect: "follow",
  };
  try {
    const response = await fetch("/api/admin/network/" + name, requestOptions);
    const result = await response.json();
    return result;
  } catch (error) {
    console.log("error", error);
    return null;
  }
}
```
This code block is also saved in the main.js page
>Note
* An async function was created to load the last saved configuration from the database



On the page for AWIN and AMAZON, the following functions were created to call the API from the main.js page

 1. The function to save:
 ```Javascript 
async function save() {
        const config = {
          accessId: document.getElementById("accessId").value,
          secretKey: document.getElementById("secretKey").value,
          regions: {
            uk: {
              publisherId: document.getElementById("publisherId").value,
              trackingId: document.getElementById("trackingId").value,
            },
          },
        };

        const successAlert = document.getElementById("success");

        //To display a success or error message
        try {
          const result = await saveNetworkConfig("AWIN", config);

          successAlert.innerText = "Saved successfully";
          successAlert.className = "alert alert-success";
        } catch (error) {
          successAlert.innerText = "Error saving to database";
          successAlert.className = "alert alert-danger";
        } finally {
          setTimeout(() => {
            successAlert.className = "alert-hidden";
          }, 3000);
        }
      }
    
```
>Note:
* A const variable containing parameters inputed into the text boxes on the page was created and saved to config
* The result of the saveNetworkConfig function is stored in a const variable called result
* A try and catch code block was created to notify the admin if the configurations were saved successfully or to display an error otherwise 


2. The function to load the last saved configuration when the page loads

```Javascript
async function load() {
        const data = await getNetworkConfig("AWIN");
        if (!data) return;
        const config = data.config;
        document.getElementById("accessId").value = config.accessId;
        document.getElementById("secretKey").value = config.secretKey;
        document.getElementById("publisherId").value =
          config.regions.uk.publisherId;
        document.getElementById("trackingId").value =
          config.regions.uk.trackingId;
      }

      load();
```
The process of connecting the end points of Rakuten and Impact to the front end so as to be able to accept inputs from the frontend is a bit different from Awin and Amazon as both of them are on the same page (the Networks page), to do it correctly the id of the affiliate ID and the Tracking ID is set to be unique for each, in this case, the prefix "rk" is added for rakuten and "im" for impact. The process is more or less the same thing


## Testing the connection to AWIN
The required parameters for testing the connection with AWIN are the API token and the publisher ID which are generated with an account with AWIN.



The function to call AWIN's API was passed but a Cross Origin Resource Sharing (CORS) error was encountered, to resolve that, an endpoint was created in the database (Web hook) that calls AWIN's API, the local endpoint is then called from the front end, i.e. the local API is called on the front end, the local API then relays the endpoint for AWIN's API to the front end.

To successfully test the connection to AWIN, the configuration must be saved first beause the country code gotten from awin for UK is "GB" so it was hardcoded

# Creating the website
The following languages are used in creating the frontend bit of the website: HTML, CSS, Bootstrap 5.0 

